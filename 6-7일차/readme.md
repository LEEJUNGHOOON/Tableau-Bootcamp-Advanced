
# 📈 Tableau Bootcamp 고급편 — Day 6 & Day 7 퀘스트 안내

> **주제:** 테이블 계산(Table Calculations) 심화 — 범위/방향(Partition/Address), Rank/Last, 누계·구성비율, 파레토 차트, 참조선 & 매개변수

---

## 🎯 학습 목표
- 개별 마크 수준을 넘는 **인접 마크 기반 계산(테이블 계산)**의 필요성과 원리를 이해한다.
- **범위(Partition)**와 **방향(Address)** 개념을 통해 계산 대상과 진행 순서를 제어한다.
- **Order of Operations**에서 테이블 계산 필터, 차원 필터, 총계의 우선순위를 이해하고 문제를 해결한다.
- **성장률(비율 차이), 순위, 최근 N기간, 파레토(80/20) & 움직이는 참조선**을 구현한다.

---

## 1) 테이블 계산이 필요한 이유

<img width="1266" height="762" alt="image (9)" src="https://github.com/user-attachments/assets/3104006f-0566-4944-92e4-75e1ccf9fb3f" />

- 기본 집계는 **뷰에 올려둔 차원(시각화 세부 수준)**의 **개별 마크 수준**에서 수행됨.  
- **누계·구성비율·성장률**처럼 **인접 마크를 고려**해야 하는 계산은 테이블 계산으로 처리.  
- 예) `[제품 대분류]` × `YEAR([주문 일자])`에서 **누계**: “테이블(옆으로)”로 설정 시, 좌→우 누산.
<img width="1392" height="768" alt="image (10)" src="https://github.com/user-attachments/assets/c625b7b3-879b-4ac5-8bc9-687e2b3d4667" />

> 뷰에서 차원을 제거하면 그 기준의 누계/성장률도 계산 불가. 테이블 계산은 **뷰에 존재하는 차원**을 대상으로 동작.

---

## 2) 범위(Partition) & 방향(Address)
- **특정 차원** 설정에서  
  - **체크 해제** = **범위(Partition)**  
  - **체크** = **방향(Address)**  
- Address는 **나열 순서의 영향**을 받음. (체크된 필드의 순서에 따라 진행 방향이 달라짐)
<img width="376" height="583" alt="image (11)" src="https://github.com/user-attachments/assets/2e3ddad3-da9c-4108-9397-c47fc6ecf667" />

<img width="1938" height="1070" alt="image (12)" src="https://github.com/user-attachments/assets/5300f4a2-f559-4aa4-8203-7af854cea4f0" />


### 예시: 정렬된 목록에 번호 매기기
```tableau
// 인덱스 부여
INDEX()
// 라벨로 쓸 경우 불연속형으로 사용
```
- [제품 대분류] 내 [제품 중분류]에 **세로 번호** 부여:  
  - 범위: 대분류(체크 해제), 방향: 중분류(체크)
- 전체를 하나의 범위로 보고 **전역 번호** 부여: 두 필드 모두 체크(순서로 방향 제어)

---

## 3) 세부 수준 계산식(LOD: FIXED) vs 테이블 계산
| 구분 | LOD(FIXED) | 테이블 계산 |
|---|---|---|
| 계산 기준 | **계산식 내부**에서 차원 고정 | **뷰에 올린 차원**에 의해 결정 |
| 실행 시점 | 쿼리 단계(원본 집계 결과) | 뷰 렌더링 단계(쿼리 이후) |
| 결과 안정성 | 뷰 변화에도 **일관** | 뷰(차원·정렬·방향)에 따라 **변동** |
| 데이터 보기 | **데이터 보기**에 노출 | 데이터 보기엔 미노출(테이블 단계 계산) |

<img width="1614" height="902" alt="image (13)" src="https://github.com/user-attachments/assets/1bad58f9-a730-4fe7-bd60-787f60cc9cd3" />


> 의도한 차원으로 항상 같은 값을 원하면 **FIXED**, 뷰 맥락에서 인접·누계·변화율을 다루면 **테이블 계산**.

---

## 4) Order of Operations (심화 예시)
### A. Rank로 Top N 필터링
- `[매출]`에 **RANK**를 적용해 순위 산출 후 **1~10** 필터.
- [제품 대분류] 차원 필터를 추가하면? → **차원 필터가 테이블 계산 필터보다 우선**  
  → 먼저 대분류=가구로 제한 → 그 **결과 내부에서** Top 10 산출.
<img width="800" height="535" alt="image (14)" src="https://github.com/user-attachments/assets/b9211a11-1308-462c-9909-ac70353fc3dc" />

```tableau
// 순위 계산식(내림차순이 기본)
RANK(SUM([매출]))      // asc 필요 시: RANK(SUM([매출]), 'asc')
```

### B. Last로 최근 N기간 고정
- `LAST()`는 **마지막 마크부터 0,1,2…** 번호를 부여.  
- 필터: `LAST() ∈ [0, 11]` → **최근 12개**만 표시.  
- 총계를 켜면? 총계는 테이블 계산 필터보다 **우선순위가 높아** 숨긴 열이 다시 보일 수 있음 → **필터 옵션 ‘총계에 적용’** 체크.

```tableau
// 최근 12개월 필터
LAST() <= 11
```

---

## 5) 퀘스트 ① — 전월 대비 성장률 계산
**목표:** 기준월/전월 매출 테이블에서 **‘비율 차이(성장률)’**를 테이블 계산으로 구현하고, 빈 열 숨기기.

### 가이드
1. [매출] → **퀵 테이블 계산: 비율 차이** (이전 마크 기준)  
2. **테이블 계산 편집**: 방향/범위, 기준(이전/다음/첫 번째) 확인  
3. **LAST() 필터**로 빈 열 숨기기(예: `0~0`)  
4. [매출] 필드 추가로 표시 정리

```tableau
// 성장률 계산 직접식(참고)
(ZN(SUM([매출])) - LOOKUP(ZN(SUM([매출])), -1))
/ LOOKUP(ZN(SUM([매출])), -1)
```
<img width="512" height="300" alt="image (15)" src="https://github.com/user-attachments/assets/e9fb39b5-226c-43bf-b9e3-076d3841d481" />

---

## 6) 퀘스트 ② — 대분류별 Top 10 제품 나열
**목표:** 각 `[제품 대분류]` 그룹마다 매출 상위 **1~10위** 제품을 막대차트로 표시(총 30개).

### 가이드
1. 행: `[제품 대분류]`, `[제품명]` / 열: `SUM([매출])` (내림차순 정렬)  
2. 계산식 생성: `RANK(SUM([매출]))`  
3. `[순위]` 뷰 추가 → **'패널(아래로)'** 기준(대분류 파티션/제품명 방향)으로 변경  
4. `[순위]`를 **필터**로 옮겨 **1~10** 지정

<img width="1700" height="809" alt="image (16)" src="https://github.com/user-attachments/assets/455c7ce6-8c38-4e5b-a40f-1161a93faba8" />

---

## 7) 퀘스트 ③ — 파레토 차트 & 움직이는 참조선
**목표:** 고객별 수익을 내림차순 정렬 → 누계 → 전체 대비 **누계 구성비율**로 변환 → 80%/20% 상수선 및 **N% 매개변수**에 따른 참조선.

### 단계 요약
1. 열: `[고객명]`, 행: `SUM([수익])` → **내림차순** + **전체 보기**  
2. [수익] **퀵 테이블 계산: 누계** → 특정 차원=고객명  
3. **보조 계산 추가:** **구성 비율(%)** 선택(특정 차원=고객명)  
4. `[고객명]` 복제 → **세부정보**에 추가(정렬: 수익 내림차순)  
5. `[고객명]`을 **측정값-카운트(고유)**로 변경 → 동일하게 **누계 + 구성비율** 적용  
6. **마크=라인**, **상수선** 추가(Y: 0.8, X: 0.2)  
7. **매개변수** `상위 N% 고객`(0~1, step 0.1) 생성 → X축 참조선에 연결  
8. 계산식 `움직이는 참조선` 작성 후 세부정보에 추가, Y축 참조선으로 사용

```tableau
// 매개변수: [상위 N% 고객] ∈ [0,1], step 0.1

// 움직이는 참조선
IF RUNNING_SUM(COUNTD([고객명])) / WINDOW_SUM(COUNTD([고객명]))
   <= [상위 N% 고객]
THEN SUM([수익]) / WINDOW_SUM(SUM([수익]))
END
```
<img width="2776" height="1844" alt="image (17)" src="https://github.com/user-attachments/assets/30f0103d-b8a4-426c-8721-d96a7175498a" />

---

## ✅ 체크리스트
- [ ] Address/Partition 설정을 **특정 차원**에서 명확히 지정했다.  
- [ ] Rank/Last/Index를 활용해 **Top N/최근 N/순번**을 구현했다.  
- [ ] **총계 ↔ 테이블 계산 필터** 순서 이슈를 이해하고 **‘총계에 적용’**으로 해결했다.  
- [ ] 파레토 차트에서 **누계 + 구성비율**을 올바르게 적용했다.  
- [ ] 매개변수를 이용한 **움직이는 참조선**을 구현했다.  

---
